<!DOCTYPE html>
<html>
<head>
    <!-- Syntax Highlighting with highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="192x192" href="../assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../assets/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="../assets/android-chrome-512x512.png">
    
    <!-- Core Stylesheets -->
    <link rel="stylesheet" href=../assets/colours-l2d.css>
    <link rel="stylesheet" href="../assets/shared-styles.css">
    <link rel="stylesheet" href="../assets/nav-bar.css">
    <link rel="stylesheet" href="../assets/module_card.css">
    <link rel="stylesheet" href="../assets/learning_outcomes.css">
    <link rel="stylesheet" href="../assets/learning_lists.css">
    <link rel="stylesheet" href="../assets/box_styles.css">
    <link rel="stylesheet" href="../assets/code_styles.css">
    <link rel="stylesheet" href="../assets/static_output.css">

    <!-- Meta Tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L2D - DH3 - Large Images</title>
        
</head>
<body>
    
    <!-- Sidebar Navigation -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <a href="../homepage.html" style="text-decoration: none; display: inline-block;">
                <img src="../assets/l2d-brain-logo.png" alt="scryptIQ Logo" class="sidebar-logo">
            </a>
        </div>

        <h3>Content</h3>
        <ul>
            <li><a href="./introduction.html" class="">Introduction</a></li><li><a href="./reading-images.html">Reading Images</a></li><li><a href="./filtering-images.html">Filtering Images</a></li>
            <li>
                <div class="nav-toggle active" data-target="expandable-section-3">
                    Large Images
                    <span class="toggle-icon">▼</span>
                </div>
                <ul class="nested-nav expanded" id="expandable-section-3"><li><a href="#introduction">Introduction</a></li><li><a href="#dealing-with-large-images">Dealing with Large Images</a></li><li><a href="#importing-from-urls">Importing from URLs</a></li><li><a href="#rescaling--downsizing">Rescaling (downsizing)</a></li><li><a href="#patching">Patching</a></li><li><a href="#summary">Summary</a></li>
                </ul>
            </li><li><a href="./3D-images.html">3-D Images</a></li><li><a href="./assignment.html">Assignment</a></li><li><a href="./feedback.html">Feedback</a></li>
        </ul>

        <h3 class="collapsible-header collapsed">
            Resources
            <span class="collapse-icon">►</span>
        </h3>
        <div class="collapsible-content collapsed">
            <ul>
                <li><a href="./glossary.html">Glossary</a></li><li><a href="./downloads.html">Downloads</a></li><li><a href="../HB/introduction.html">Handbook</a></li>
            </ul>
        </div>

        <h3 class="collapsible-header collapsed">
            Previous Modules
            <span class="collapse-icon">►</span>
        </h3>
        <div class="collapsible-content collapsed">
            <ul>
            <li><a href="../DH1/introduction.html">DH1</a></li>
            <li><a href="../DH2/introduction.html">DH2</a></li>
        </ul>
        </div>

        <h3>
            <li><a href="./report-issue.html">Report an Issue</a></li>
        </h3>
    </div>
    
    <!-- Sidebar Toggle Button -->
    <button id="sidebar-toggle" class="sidebar-toggle">❮</button>
    
    <!-- Main Content Area -->
    <div id="main-content" class="main-content">
        <!-- Top Navigation Bar -->
        <div class="top-navbar">
            <h1 class="page-title">Data Handling 3</h1>
            <div class="nav-actions">
                <a href="../homepage.html" class="text-button" title="Materials homepage">
                    Homepage
                </a>
                <a href="https://learntodiscover.ai/my-cohorts/" class="text-button" title="Find out more about us">
                    Learn to Discover
                </a>
            </div>
        </div>

        
            <div class="module-card" id="introduction">
                <div class="module-header">
                    Large Images <span class="module-tag">DH3</span>
                </div>
                <div class="module-body">
                    <h3>Learning Objectives</h3>
                    <div class="learning-outcomes">
                        <div class="outcome-item">
                    <span class="outcome-number">1</span>
                    <span class="outcome-text">How to import and work with large images</span>
                </div>
<div class="outcome-item">
                    <span class="outcome-number">2</span>
                    <span class="outcome-text">Decreasing memory load when dealing with images</span>
                </div>
                    </div>
                    <h3>Introduction</h3>
                    <p>Often, we encounter situations where we have to deal with very large images that are composed of many pixels. Images such as these are often difficult to process, as they can require a lot of computer memory to do so. We will explore two different strategies for dealing with this problem - decreasing resolution, and using patches from the original image.</p>
                </div>
            </div>
            
            <div class="module-card" id="dealing-with-large-images">
                <div class="module-body">
                    <div class="module-section">
                        <h3>Dealing with Large Images</h3>
                        <p>To demonstrate this problem, we can make use of the full-resolution version of the rat brain image we used in the first sub-module.<br><br>Since the file is quite large, and this is an instructional course where you may wish to use a GitHub Codespace to practise these examples. As this file is too large to be uploaded to GitHUb we will use an online, remotely-hosted copy of the image.</p>
        <div class="info-box warning-box">
            <div class="box-title">
                <span class="box-icon"></span>
                WARNING
            </div>
            <div class="box-content">
                <p>To process this image with Pyodide (the software that lets you code in the browser in real time), we need to slightly downscale the high resolution image as we import it. This is in the backend, so you won&#x27;t see it. Even then it is slow to process and takes up a lot of memory. If you find your page refreshing and starting over, try downloading the notebook (<em>see resources</em>) and running it locally or in a CodeSpace. Doing so you will be working with the full resolution image and have fewer issues.</p>
            </div>
        </div>
        <p>In order to do this, we will firstly store our image URL in a variable for ease of handling:</p>
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-29">from matplotlib.pyplot import subplots, show
from matplotlib.image import imread

# URL to the remotely hosted PNG image
url = &quot;https://media.githubusercontent.com/media/L2D-Assets/Assets/refs/heads/master/rat_brain.png&quot;</code></pre>
            </div>
            
        </div>
        
                    </div>
                </div>
            </div>
            
            <div class="module-card" id="importing-from-urls">
                <div class="module-body">
                    <div class="module-section">
                        <h3>Importing from URLs</h3>
                        <p>Next, we must bypass the validation of the server&#x27;s certificate, for ease. SSL stands for Secure Sockets Layer, which is a standard way of providing an encrypted connection between a server and a client. As this is an instructional material, we are disabling this, as we trust the issuing author of the source file (ourselves).</p>
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-30">import ssl

# Disable SSL verification
ssl_context = ssl._create_unverified_context()</code></pre>
            </div>
            
        </div>
        <p>Lastly, we must then import the function <code>urlopen</code> and the class <code>BytesIO</code>, where the former allows us to open the URL as raw binary data, and the latter wraps this into memory, simulating a file object. This allows us to work with this online, remotely-hosted large image, from its remote location. Please be patient - this step can take time, and will depend on the speed of your internet connection.</p>
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-31">from urllib.request import urlopen
from io import BytesIO

# Consolidate into &#x27;remote_image&#x27;
remote_image = BytesIO(urlopen(url, context=ssl_context).read())</code></pre>
            </div>
            
        </div>
        
        <div class="info-box note-box">
            <div class="box-title">
                <span class="box-icon"></span>
                NOTE
            </div>
            <div class="box-content">
                <p>This demonstrates how to read a remotely-hosted image into memory. However, if you wish to try this with a large image stored locally on your computer you can bypass the steps above and use the lines of code that is commented out in the cells below, instead of the line immediately above.</p>
            </div>
        </div>
        <p>Next, we can read the image into Python, using the imread() function. However, if we do this plainly, we will receive a warning from Python indicating that the &quot;Image size (324649360 pixels) exceeds limit of 178956970 pixels, could be decompression bomb DOS attack.&quot; This alludes to a potential malicious file, designed to crash or cause disruption by using consuming large amounts of memory.<br><br>We can get around this by changing the maximum pixel limit, for which we will require the Image module from the Python Imaging Library (PIL). We will make use of the <code>MAX_IMAGE_PIXELS</code> class-level attribute in order to do this, as follows:</p>
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-32">from PIL import Image

# Disables the decompression bomb check:
Image.MAX_IMAGE_PIXELS = 1000000000</code></pre>
            </div>
            
        </div>
        <p>Let&#x27;s try to use <code>imread</code>, again. Please be patient, as this may take a moment to execute.</p>
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-33"># Use &#x27;remote_image&#x27; with imread:
img_hr = imread(remote_image)
# img_hr = imread(&#x27;fig/rat_brain.png&#x27;) # For local image processing.</code></pre>
            </div>
            
        </div>
        
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-34">img_hr.shape</code></pre>
            </div>
            <div class="output-container"><pre class="output-error">---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
Cell In[6], line 3
      1 # FIXED WITH OUTPUT
----&gt; 3 img_hr.shape

NameError: name &#x27;img_hr&#x27; is not defined</pre></div>
        </div>
        
        <div class="info-box note-box">
            <div class="box-title">
                <span class="box-icon"></span>
                NOTE
            </div>
            <div class="box-content">
                <p>The actual dimensions of the image are <code>(17360, 18701, 3)</code> before we downscaled it. This is what you should see if working locally or in a CodeSpace.</p>
            </div>
        </div>
        <p>Now we can plot the full high-resolution image:</p>
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-35">fig, ax = subplots(figsize=(25, 15))

ax.imshow(img_hr);

show()</code></pre>
            </div>
            <div class="output-container"><pre class="output-error">---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
Cell In[7], line 3
      1 # FIXED WITH OUTPUT
----&gt; 3 fig, ax = subplots(figsize=(25, 15))
      5 ax.imshow(img_hr);
      7 show()

NameError: name &#x27;subplots&#x27; is not defined</pre></div>
        </div>
        
                    </div>
                </div>
            </div>
            
            <div class="module-card" id="rescaling--downsizing">
                <div class="module-body">
                    <div class="module-section">
                        <h3>Rescaling (downsizing)</h3>
                        <p>Although now we can plot this image, it does still consist of over 300 million pixels, which could run us into memory problems when attempting to process it. One approach is simply to reduce the resolution by importing the image using the Image module from the PIL library: which we imported in the code given, above. This library gives us a wealth of tools to process images, including methods to decrease an image&#x27;s resolution. PIL is a very rich library with a multitude of useful tools. As always, having a look at the official <a href="https://pillow.readthedocs.io/en/stable/">documentation</a> and playing around with it yourself is highly encouraged.<br><br>We can make use of the <code>resize</code> method to downsample the image, providing the desired width and height as numerical arguments, as follows:</p>
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-36"># Open the remotely hosted image:
img_pil = Image.open(remote_image) </code></pre>
            </div>
            
        </div>
        
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-37"># As a PIL image we can use methods such as .resize()
img_small = img_pil.resize((174, 187))

print(type(img_small))</code></pre>
            </div>
            <div class="output-container"><pre class="output-error">---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
Cell In[9], line 4
      1 # FIXED WITH OUTPUT
      2 
      3 # As a PIL image we can use methods such as .resize()
----&gt; 4 img_small = img_pil.resize((174, 187))
      6 print(type(img_small))

NameError: name &#x27;img_pil&#x27; is not defined</pre></div>
        </div>
        <p>Plotting should now be considerably quicker.</p>
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-38">fig, ax = subplots(figsize=(25, 15))

ax.imshow(img_small);

show()</code></pre>
            </div>
            <div class="output-container"><pre class="output-error">---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
Cell In[10], line 3
      1 # FIXED WITH OUTPUT
----&gt; 3 fig, ax = subplots(figsize=(25, 15))
      5 ax.imshow(img_small);
      7 show()

NameError: name &#x27;subplots&#x27; is not defined</pre></div>
        </div>
        <p>Using the above code, we have successfully resized the image to a resolution of 174 x 187 pixels. It is, however, important to note that our image is no longer in the format of a NumPy array, but rather it now has the type <code>PIL.Image.Image</code>. We can, however, easily convert it back into a NumPy array using the array function, if we so wish.</p>
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-39">from numpy import array

img_numpy = array(img_small)

print(type(img_numpy))</code></pre>
            </div>
            <div class="output-container"><pre class="output-error">---------------------------------------------------------------------------
ModuleNotFoundError                       Traceback (most recent call last)
Cell In[11], line 3
      1 # FIXED WITH OUTPUT
----&gt; 3 from numpy import array
      5 img_numpy = array(img_small)
      7 print(type(img_numpy))

ModuleNotFoundError: No module named &#x27;numpy&#x27;</pre></div>
        </div>
        
                    </div>
                </div>
            </div>
            
            <div class="module-card" id="patching">
                <div class="module-body">
                    <div class="module-section">
                        <h3>Patching</h3>
                        <p>Despite the above, it is often desired to keep images in their full resolution, as resizing effectively results in a loss of information. A commonly used, alternative approach to such downsampling is to <strong>patch</strong> the images. Patching an image essentially divides the picture up into smaller chunks that are termed patches.<br><br>For this, we can implement functionality from the <a href="https://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.image.extract_patches_2d.html">Scikit-Learn</a> machine learning library.</p>
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-40">from sklearn.feature_extraction.image import extract_patches_2d</code></pre>
            </div>
            
        </div>
        <p>The <code>extract_patches_2d</code> function is used to extract parts of the image. The shape of each patch, together with the maximal number of patches, can be specified, as follows:</p>
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-41">patches = extract_patches_2d(img_hr, (57, 60), max_patches=100)

# Use the below if working locally as the image will have more pixels!
# extract_patches_2d(img_hr, (174, 187), max_patches=100)</code></pre>
            </div>
            
        </div>
        
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-42">patches.shape</code></pre>
            </div>
            <div class="output-container"><pre class="output-error">---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
Cell In[14], line 3
      1 # FIXED WITH OUTPUT
----&gt; 3 patches.shape

NameError: name &#x27;patches&#x27; is not defined</pre></div>
        </div>
        <p>When using the <code>.shape</code> attribute, the output given here shows that the image has been successfully subdivided into 100 patches, with resolution 57 x 60 pixels, across three channels: red, blue and green (as this is an RGB, colour image).</p>
        <div class="info-box warning-box">
            <div class="box-title">
                <span class="box-icon"></span>
                WARNING
            </div>
            <div class="box-content">
                <p>Patching itself can be a memory-intensive task, as the code makes a view of all possible patches into memory. Extracting lots and lots of patches may take a long time.</p>
            </div>
        </div>
        <p>To look at the patches, we can make use of a for loop to iterate through the first element of the <code>.shape</code> array (the 100 patches), and visualise each one on its own subplot using the <code>.imshow</code> method, as follows:</p>
        <div class="code-area">
            <div class="code-container code-fixed">
                <pre><code class="language-python" id="code-43">fig, ax = subplots(nrows=10, ncols=10, figsize=(15, 15))

ax = ax.flatten()

for index in range(patches.shape[0]):
    ax[index].imshow(patches[index, :, :, :])

show()</code></pre>
            </div>
            <div class="output-container"><pre class="output-error">---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
Cell In[15], line 3
      1 # FIXED WITH OUTPUT
----&gt; 3 fig, ax = subplots(nrows=10, ncols=10, figsize=(15, 15))
      5 ax = ax.flatten()
      7 for index in range(patches.shape[0]):

NameError: name &#x27;subplots&#x27; is not defined</pre></div>
        </div>
        <p>Working with these smaller, individual patches will be much more manageable and computationally resourceful.</p>
                    </div>
                </div>
            </div>
            
            <div class="module-card" id="summary">
                <div class="module-body">
                    <div class="module-section">
                        <h3>Summary</h3>
                        <p>Learning to manage memory-intensive, high-resolution images through strategic downsampling and patching techniques allows us to process images that would otherwise often exceed computational limits. Downsampling reduces image resolution while maintaining overall structure, providing a quick solution when pixel-perfect detail is not essential. Alternatively, extracting smaller patches from full-resolution images preserves fine detail while simultaneously dividing the computational load into manageable chunks. These approaches can enable efficient processing of large datasets, such as whole-slide microscopy images or high-resolution fluorescence scans, without sacrificing analytical capability or requiring prohibitively powerful hardware.</p>
                    </div>
                </div>
            </div>
            
        
        <div class="page-navigation">
            <a href="./filtering-images.html" class="nav-button prev">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                </svg>
                Previous
            </a>
            <a href="./3D-images.html" class="nav-button next">
                Next
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
                </svg>
            </a></div>
        
        <!-- Footer -->
        <div class="footer">
            <div>© All materials are copyright scryptIQ 2025</div>
            <div>Static Notebook - Pre-executed Content</div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="../assets/main.js"></script>
    
    <!-- Initialize syntax highlighting -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
        });
    </script>
</body>
</html>
    